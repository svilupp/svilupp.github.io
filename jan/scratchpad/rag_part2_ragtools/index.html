<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <!-- bootstrap@5.3.1 and bootstrap icon@1.10--> <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel=stylesheet  integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin=anonymous >--> <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"> <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"> <link data-n-head=ssr  rel=stylesheet  href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin=anonymous  referrerpolicy=no-referrer  /> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous  referrerpolicy=no-referrer  /> <!-- favicon generated through https://realfavicongenerator.net/--> <script src="https://cdn.tailwindcss.com"></script> <link rel=stylesheet  href="/css/franklin.css"> <link rel=apple-touch-icon  sizes=180x180  href="/assets/icon/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="/assets/icon/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="/assets/icon/favicon-16x16.png"> <link rel=manifest  href="/assets/icon/site.webmanifest"> <link rel=mask-icon  href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5"> <meta name=msapplication-TileColor  content="#da532c"> <meta name=theme-color  content="#ffffff"> <link rel=stylesheet  href="/_css/custom.css"> <title>Building a RAG Chatbot over DataFrames.jl Documentation - Easy Mode</title> <!-- {{ispage /jan/index.html}} {{insert head_tailwind.html}} {{end}} {{ispage /index.html}} {{insert head_tailwind.html}} {{end}} {{ispage /jan/wip.html}} {{insert head_tailwind.html}} {{end}} {{ispage /jan/scratchpad/index.html}} {{insert head_tailwind.html}} {{end}} --> <header class=dark > <nav class="bg-gray-800 fixed w-full z-50"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div class="flex items-center justify-between h-16"> <div class="flex items-center flex-1"> <a href="/" class="flex items-center text-white"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill=none  viewBox="0 0 16 16" stroke=currentColor > <path d="M5 10.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/> <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/> <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/> </svg> <strong>siml.earth</strong> </a> <div class="hidden md:block ml-6"> <div class="flex items-center space-x-4"> <div class="relative group"> <button class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"> Sites </button> <div class="hidden group-hover:block absolute z-50 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 before:content-[''] before:absolute before:top-[-10px] before:left-0 before:w-full before:h-[10px]"> <div class=py-1 > <div class="px-4 py-2 text-sm text-gray-700">Choose a Site</div> <a href="/jan/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Jan's Site</a> <a href="/ann/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Ann's Site</a> </div> </div> </div> <div class="border-l border-gray-700 h-6"></div> <span class="text-gray-300 font-bold">Jan's:</span> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Home</a> <a href="/jan/scratchpad/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Posts</a> <a href="/jan/wip/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Work in Progress</a> <a href="/jan/about/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">About</a> <a href="/jan/tags/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Tags</a> <a href="/jan/privacy_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Privacy Policy</a> <a href="/jan/cookie_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Cookie Policy</a> </div> </div> </div> <button type=button  class="md:hidden bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none" aria-controls=mobile-menu  aria-expanded=false > <span class=sr-only >Open main menu</span> <svg class="h-6 w-6" fill=none  viewBox="0 0 24 24" stroke=currentColor > <path stroke-linecap=round  stroke-linejoin=round  stroke-width=2  d="M4 6h16M4 12h16M4 18h16" /> </svg> </button> </div> </div> <div class="md:hidden hidden" id=mobile-menu > <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Jan's Site</a> <a href="/ann/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Ann's Site</a> <div class="border-t border-gray-700 my-2"></div> <span class="text-gray-300 font-bold px-3">Jan's:</span> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Home</a> <a href="/jan/scratchpad/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Posts</a> <a href="/jan/wip/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Work in Progress</a> <a href="/jan/about/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">About</a> <a href="/jan/tags/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Tags</a> <a href="/jan/privacy_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Privacy Policy</a> <a href="/jan/cookie_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Cookie Policy</a> </div> </div> </nav> </header> <div class="container px-3 mx-auto pt-20"> <div class="max-w-4xl mx-auto"> <h1 class="text-4xl font-bold mb-4 text-center">Building a RAG Chatbot over DataFrames.jl Documentation - Easy Mode</h1> <p class="text-gray-600 mb-8 text-center">23 December 2023</p> </div> <div class=franklin-content ><h1 id=tldr ><a href="#tldr" class=header-anchor >TL;DR</a></h1> <p>Elevating our RAG chatbot development, this post explores the integration of PromptingTools.jl and RAGTools, showcasing a more efficient approach to building a chatbot using the DataFrames.jl documentation. We&#39;ll also delve into system evaluations.</p> <p><div class=franklin-toc ><ol><li><a href="#tldr">TL;DR</a><ol><li><a href="#effortless_rag_system_building_with_ragtools">Effortless RAG System Building with RAGTools</a><li><a href="#rag_in_two_lines">RAG in Two Lines</a><li><a href="#evaluations_assessing_quality">Evaluations: Assessing Quality</a><ol><li><a href="#generate_qa_pairs">Generate Q&amp;A Pairs</a></ol><li><a href="#explore_a_qa_pair">Explore a Q&amp;A pair</a><li><a href="#judging_a_qa_pair">Judging a Q&amp;A Pair</a><li><a href="#evaluate_the_whole_set">Evaluate the Whole Set</a></ol><li><a href="#where_to_go_from_here">Where to Go From Here?</a></ol></div> </p> <p>Last time, we crafted a RAG chatbot from scratch. Today, we&#39;re taking a leap forward with PromptingTools.jl and its experimental sub-module, RAGTools, for a more streamlined experience in Julia. Ready to dive deeper?</p> <h2 id=effortless_rag_system_building_with_ragtools ><a href="#effortless_rag_system_building_with_ragtools" class=header-anchor >Effortless RAG System Building with RAGTools</a></h2> <p>Remember, &quot;RAG&quot; is a cornerstone in Generative AI right now. If you&#39;re new to &quot;RAG&quot;, this <a href="https://towardsdatascience.com/add-your-own-data-to-an-llm-using-retrieval-augmented-generation-rag-b1958bf56a5a">article</a> is a great starting point.</p> <p>Even if you are familiar with RAG, I would strongly recommend watching <a href="https://www.youtube.com/watch?v&#61;TRjq7t2Ms5I&amp;ab_channel&#61;AIEngineer">Jerry Liu&#39;s talk on Building Production-Ready RAG Applications</a>. It&#39;s well spent 20 minutes and will help you understand the further sections in this article.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> LinearAlgebra, SparseArrays
<span class=hljs-keyword >using</span> PromptingTools
<span class=hljs-keyword >using</span> PromptingTools.Experimental.RAGTools
<span class=hljs-comment >## Note: RAGTools module is still experimental and will change in the future. Ideally, they will be cleaned up and moved to a dedicated package</span>
<span class=hljs-keyword >using</span> JSON3, Serialization, DataFramesMeta
<span class=hljs-keyword >using</span> Statistics: mean
<span class=hljs-keyword >const</span> PT = PromptingTools
<span class=hljs-keyword >const</span> RT = PromptingTools.Experimental.RAGTools</code></pre> <h2 id=rag_in_two_lines ><a href="#rag_in_two_lines" class=header-anchor >RAG in Two Lines</a></h2> <p>Start by grabbing a few text pages from the <a href="https://dataframes.juliadata.org/stable/">DataFrames.jl documentation</a>, saving them as text files in <code>examples/data</code>. Aim for clean content, free of headers and footers. Remember, garbage in, garbage out&#33;</p> <pre><code class="julia hljs">files = [
    joinpath(<span class=hljs-string >&quot;examples&quot;</span>, <span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-string >&quot;database_style_joins.txt&quot;</span>),
    joinpath(<span class=hljs-string >&quot;examples&quot;</span>, <span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-string >&quot;what_is_dataframes.txt&quot;</span>),
]
<span class=hljs-comment ># Build an index of chunks, embed them, and create a lookup index of metadata/tags for each chunk</span>
index = build_index(files; extract_metadata = <span class=hljs-literal >false</span>);</code></pre> <p>Let&#39;s ask a question</p> <pre><code class="julia hljs"><span class=hljs-comment ># Embeds the question, finds the closest chunks in the index, and generates an answer from the closest chunks</span>
answer = airag(index; question = <span class=hljs-string >&quot;I like dplyr, what is the equivalent in Julia?&quot;</span>)</code></pre> <pre><code class="julia hljs">AIMessage(<span class=hljs-string >&quot;The equivalent package in Julia to dplyr in R is DataFramesMeta.jl. It provides convenience functions for data manipulation with syntax similar to dplyr.&quot;</span>)</code></pre>
<p>And there you have it, a RAG system in just two lines&#33;</p>
<p>What does it do?</p>
<ul>
<li><p><code>build_index</code> chunks and embeds the documents, creating a metadata index.</p>
<ul>
<li><p><code>index</code> is the result of this step and it holds your chunks, embeddings, and other metadata&#33; Just show it :&#41;</p>

</ul>

<li><p><code>airag</code> embeds your question, finds relevant chunks, and optionally applies tags or filters to refine the search. It then generates an answer based on the best-matched chunks.</p>
<ul>
<li><p>embed your question</p>

<li><p>find the closest chunks in the index &#40;use parameters <code>top_k</code> and <code>minimum_similarity</code> to tweak the &quot;relevant&quot; chunks&#41;</p>

<li><p>&#91;OPTIONAL&#93; extracts any potential tags/filters from the question and applies them to filter down the potential candidates &#40;use <code>extract_metadata&#61;true</code> in <code>build_index</code>, you can also provide some filters explicitly via <code>tag_filter</code>&#41;</p>

<li><p>&#91;OPTIONAL&#93; re-ranks the candidate chunks &#40;define and provide your own <code>rerank_strategy</code>, eg Cohere ReRank API&#41;</p>

<li><p>build a context from the closest chunks &#40;use <code>chunks_window_margin</code> to tweak if we include preceding and succeeding chunks as well, see <code>?build_context</code> for more details&#41;</p>

</ul>

<li><p>generate an answer from the closest chunks &#40;use <code>return_context&#61;true</code> to see under the hood and debug your application&#41;</p>

</ul>
<p>You should save the index for later to avoid re-embedding / re-extracting the document chunks&#33;</p>
<pre><code class="julia hljs">serialize(<span class=hljs-string >&quot;examples/index.jls&quot;</span>, index)
index = deserialize(<span class=hljs-string >&quot;examples/index.jls&quot;</span>);</code></pre>
<h2 id=evaluations_assessing_quality ><a href="#evaluations_assessing_quality" class=header-anchor >Evaluations: Assessing Quality</a></h2>
<p>To gauge the effectiveness of our system, we need a golden set of quality Q&amp;A pairs. Creating these manually is ideal but can be labor-intensive. Instead, let&#39;s generate them from our index:</p>
<h3 id=generate_qa_pairs ><a href="#generate_qa_pairs" class=header-anchor >Generate Q&amp;A Pairs</a></h3>
<p>Here&#39;s how to create evaluation sets from your <code>index</code> &#40;we need the text chunks and corresponding file paths/sources&#41;.</p>
<pre><code class="julia hljs">evals = build_qa_evals(RT.chunks(index),
    RT.sources(index);
    instructions = <span class=hljs-string >&quot;None.&quot;</span>,
    verbose = <span class=hljs-literal >true</span>);</code></pre>
<pre><code class="julia hljs">[ Info: Q&amp;A Sets built! (cost: $<span class=hljs-number >0.102</span>)</code></pre>
<blockquote>
<p>&#91;&#33;TIP&#93; In practice, you would review each item in this golden evaluation set &#40;and delete any generic/poor questions&#41;. It will determine the future success of your app, so you need to make sure it&#39;s good&#33;</p>
</blockquote>
<p>Save your evaluation sets for later use &#40;and ideally review them manually&#41;.</p>
<pre><code class="julia hljs">JSON3.write(<span class=hljs-string >&quot;examples/evals.json&quot;</span>, evals)
evals = JSON3.read(<span class=hljs-string >&quot;examples/evals.json&quot;</span>, <span class=hljs-built_in >Vector</span>{RT.QAEvalItem});</code></pre>
<h3 id=explore_a_qa_pair ><a href="#explore_a_qa_pair" class=header-anchor >Explore a Q&amp;A pair</a></h3>
<p>Here&#39;s a sample Q&amp;A pair to illustrate the process &#40;it&#39;s not the best quality but gives you the idea&#41;:</p>
<pre><code class="julia hljs">evals[<span class=hljs-number >1</span>]</code></pre>
<pre><code class="julia hljs">QAEvalItem:
 source: examples/data/database_style_joins.txt
 context: Database-Style Joins
Introduction to joins
We often need to combine two or more data sets together to provide a complete picture of the topic we are studying. For example, suppose that we have the following two data sets:

julia&gt; <span class=hljs-keyword >using</span> DataFrames
 question: What is the purpose of joining two or more data sets together?
 answer: The purpose of joining two or more data sets together is to provide a complete picture of the topic being studied.</code></pre>
<h3 id=judging_a_qa_pair ><a href="#judging_a_qa_pair" class=header-anchor >Judging a Q&amp;A Pair</a></h3>
<p>So let&#39;s say we use this Q&amp;A pair to evaluate our system, we plug this Question into <code>airag</code> and get a new answer back. But how do we know it&#39;s good?</p>
<p>We use a &quot;judge model&quot; &#40;like GPT-4&#41; for evaluation &#40;we extract a <code>final_rating</code>&#41;:</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Note: that we used the same question, but generated a different context and answer via `airag`</span>
msg, ctx = airag(index; evals[<span class=hljs-number >1</span>].question, return_context = <span class=hljs-literal >true</span>);
<span class=hljs-comment ># ctx is a RAGContext object that keeps all intermediate states of the RAG pipeline for easy evaluation</span>
judged = aiextract(:RAGJudgeAnswerFromContext;
    ctx.context,
    ctx.question,
    ctx.answer,
    return_type = RT.JudgeAllScores)
judged.content</code></pre>
<pre><code class="julia hljs"><span class=hljs-built_in >Dict</span>{<span class=hljs-built_in >Symbol</span>, <span class=hljs-built_in >Any</span>} with <span class=hljs-number >6</span> entries:
  :final_rating =&gt; <span class=hljs-number >4.8</span>
  :clarity =&gt; <span class=hljs-number >5</span>
  :completeness =&gt; <span class=hljs-number >4</span>
  :relevance =&gt; <span class=hljs-number >5</span>
  :consistency =&gt; <span class=hljs-number >5</span>
  :helpfulness =&gt; <span class=hljs-number >5</span></code></pre>
<p>But <code>final_rating</code> for the generated answer is not the only metric we should watch. We should also judge the quality of the provided context &#40;&quot;retrieval_score&quot;&#41; and a few others.</p>
<p>This generation&#43;evaluation loop and a few common metrics are available in <code>run_qa_evals</code>:</p>
<pre><code class="julia hljs">x = run_qa_evals(evals[<span class=hljs-number >10</span>], ctx;
    parameters_dict = <span class=hljs-built_in >Dict</span>(:top_k =&gt; <span class=hljs-number >3</span>), verbose = <span class=hljs-literal >true</span>, model_judge = <span class=hljs-string >&quot;gpt4t&quot;</span>)</code></pre>
<pre><code class="julia hljs">QAEvalResult:
 source: examples/data/database_style_joins.txt
 context: outerjoin: the output contains rows <span class=hljs-keyword >for</span> values of the key that exist <span class=hljs-keyword >in</span> any of the passed data frames.
semijoin: Like an inner join, but output is restricted to columns from the first (left) argument.
 question: What is the difference between outer join and semi join?
 answer: The purpose of joining two or more data sets together is to combine them <span class=hljs-keyword >in</span> order to provide a complete picture or analysis of a specific topic or dataset. By joining data sets, we can combine information from multiple sources to gain more insights and make more informed decisions.
 retrieval_score: <span class=hljs-number >0.0</span>
 retrieval_rank: <span class=hljs-literal >nothing</span>
 answer_score: <span class=hljs-number >5</span>
 parameters: <span class=hljs-built_in >Dict</span>(:top_k =&gt; <span class=hljs-number >3</span>)</code></pre>
<p>QAEvalResult is a simple struct that holds the evaluation results for a single Q&amp;A pair. It becomes useful when we evaluate a whole set of Q&amp;A pairs &#40;see below&#41;.</p>
<h2 id=evaluate_the_whole_set ><a href="#evaluate_the_whole_set" class=header-anchor >Evaluate the Whole Set</a></h2>
<p>Fortunately, we don&#39;t have to do the evaluations manually one by one.</p>
<p>Let&#39;s run each question &amp; answer through our eval loop in async &#40;we do it only for the first 10 to save time&#41;. See the <code>?airag</code> for which parameters you can tweak, eg, <code>top_k</code></p>
<pre><code class="julia hljs">results = asyncmap(evals[<span class=hljs-number >1</span>:<span class=hljs-number >10</span>]) <span class=hljs-keyword >do</span> qa_item
    <span class=hljs-comment ># Generate an answer -- often you want the model_judge to be the highest quality possible, eg, &quot;GPT-4 Turbo&quot; (alias &quot;gpt4t)</span>
    msg, ctx = airag(index; qa_item.question, return_context = <span class=hljs-literal >true</span>,
        top_k = <span class=hljs-number >3</span>, verbose = <span class=hljs-literal >false</span>, model_judge = <span class=hljs-string >&quot;gpt4t&quot;</span>)
    <span class=hljs-comment ># Evaluate the response</span>
    <span class=hljs-comment ># Note: you can log key parameters for easier analysis later</span>
    run_qa_evals(qa_item, ctx; parameters_dict = <span class=hljs-built_in >Dict</span>(:top_k =&gt; <span class=hljs-number >3</span>), verbose = <span class=hljs-literal >false</span>)
<span class=hljs-keyword >end</span>
<span class=hljs-comment >## Note that the &quot;failed&quot; evals can show as &quot;nothing&quot; (failed as in there was some API error or parsing error), so make sure to handle them.</span>
results = filter(x-&gt;!isnothing(x.answer_score), results);</code></pre>
<p>Note: You could also use the vectorized version <code>results &#61; run_qa_evals&#40;evals&#41;</code> to evaluate all items at once and skip the above code block.</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Let&#x27;s take a simple average to calculate our score</span>
<span class=hljs-meta >@info</span> <span class=hljs-string >&quot;RAG Evals: <span class=hljs-subst >$(length(results)</span>) results, Avg. score: <span class=hljs-subst >$(round(mean(x-&gt;x.answer_score, results)</span>;digits=1)), Retrieval score: <span class=hljs-subst >$(<span class=hljs-number >100</span>*round(<span class=hljs-built_in >Int</span>,mean(x-&gt;x.retrieval_score,results)</span>))%&quot;</span></code></pre>
<pre><code class="julia hljs">[ Info: RAG Evals: <span class=hljs-number >10</span> results, Avg. score: <span class=hljs-number >4.6</span>, Retrieval score: <span class=hljs-number >100</span>%</code></pre>
<p>Note: The retrieval score is 100&#37; only because we have two small documents and running on 10 items only. In practice, you would have a much larger document set and a much larger eval set, which would result in a more representative retrieval score.</p>
<p>If you prefer, you can also analyze the results in a DataFrame:</p>
<pre><code class="julia hljs">df = DataFrame(results)</code></pre>
<p>We&#39;re done for today&#33;</p>
<h1 id=where_to_go_from_here ><a href="#where_to_go_from_here" class=header-anchor >Where to Go From Here?</a></h1>
<ul>
<li><p>Review your evaluation golden data set and keep only the good items</p>

<li><p>Experiment with the chunk sizes &#40;<code>max_length</code> in <code>build_index</code>&#41;</p>

<li><p>Explore using metadata/key filters &#40;<code>extract_metadata&#61;true</code> in <code>build_index</code>&#41;</p>

<li><p>Add filtering for semantic similarity &#40;embedding distance&#41; to make sure we don&#39;t pick up irrelevant chunks in the context &#40;<code>minimum_similarity</code> in <code>airag</code>&#41;</p>

<li><p>Use multiple indices or a hybrid index &#40;add a simple BM25 lookup from <code>TextAnalysis.jl</code>&#41;</p>

<li><p>Data processing is the most important step - properly parsed and split text could make wonders, so review your current approach</p>

<li><p>Add re-ranking of context &#40;see <code>rerank</code> function, you can use Cohere ReRank API&#41;</p>

<li><p>Improve the question embedding &#40;eg, rephrase it, generate hypothetical answers and use them to find better context&#41;</p>

<li><p>Try different models and providers for different parts of the RAG pipeline</p>

</ul>
<p>... and much more&#33; See some ideas in <a href="https://www.anyscale.com/blog/a-comprehensive-guide-for-building-rag-based-llm-applications-part-1">Anyscale RAG tutorial</a></p>
<p>If you want to learn more about helpful patterns and advanced evaluation techniques &#40;eg, how to measure &quot;hallucinations&quot;&#41;, check out this talk by <a href="https://www.youtube.com/watch?v&#61;LzeC1AQ-U5o&amp;t&#61;4s&amp;ab_channel&#61;AIEngineer">Eugene Yan: Building Blocks for LLM Systems &amp; Products</a>.</p>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Jan Siml. Last modified: December 09, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia asdasdas programming language</a>.
</div>
</div></div> 

<footer class="container mx-auto px-4 py-4 border-t">
  
  <p class="text-right mb-3">
    <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">Back to top</a>
  </p>
  
  
  <div class="flex flex-col items-center justify-center space-y-3">
    
    <div class=footer-icons >
      <ul class="flex items-center space-x-4">
        <li class="text-gray-700 font-medium">Follow:
        <li>
          <a href="https://github.com/svilupp" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors" rel="nofollow noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" width=20  height=20  fill=currentColor  class="bi bi-github" viewBox="0 0 16 16">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            <span>GitHub</span>
          </a>
        
      </ul>
    </div>

    
    <p class="text-sm text-gray-600">
      &copy; 2024 · 
      <a href="#" class="hover:text-gray-900 transition-colors">Privacy</a> · 
      <a href="#" class="hover:text-gray-900 transition-colors">Terms</a>
    </p>
  </div>
</footer>





  <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>


<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script>
  // Mobile menu toggle
  const mobileMenuButton = document.querySelector('[aria-controls="mobile-menu"]');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuButton.addEventListener('click', () => {
    const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
    mobileMenuButton.setAttribute('aria-expanded', !expanded);
    mobileMenu.classList.toggle('hidden');
  });
</script>