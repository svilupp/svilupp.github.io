<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <!-- bootstrap@5.3.1 and bootstrap icon@1.10--> <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel=stylesheet  integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin=anonymous >--> <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"> <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"> <link data-n-head=ssr  rel=stylesheet  href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin=anonymous  referrerpolicy=no-referrer  /> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous  referrerpolicy=no-referrer  /> <!-- favicon generated through https://realfavicongenerator.net/--> <script src="https://cdn.tailwindcss.com"></script> <link rel=stylesheet  href="/css/franklin.css"> <link rel=apple-touch-icon  sizes=180x180  href="/assets/icon/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="/assets/icon/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="/assets/icon/favicon-16x16.png"> <link rel=manifest  href="/assets/icon/site.webmanifest"> <link rel=mask-icon  href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5"> <meta name=msapplication-TileColor  content="#da532c"> <meta name=theme-color  content="#ffffff"> <link rel=stylesheet  href="/_css/custom.css"> <title>Running a 70 Billion-Parameter LLM on Your Laptop?</title> <!-- {{ispage /jan/index.html}} {{insert head_tailwind.html}} {{end}} {{ispage /index.html}} {{insert head_tailwind.html}} {{end}} {{ispage /jan/wip.html}} {{insert head_tailwind.html}} {{end}} {{ispage /jan/scratchpad/index.html}} {{insert head_tailwind.html}} {{end}} --> <header class=dark > <nav class="bg-gray-800 fixed w-full z-50"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div class="flex items-center justify-between h-16"> <div class="flex items-center flex-1"> <a href="/" class="flex items-center text-white"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill=none  viewBox="0 0 16 16" stroke=currentColor > <path d="M5 10.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/> <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/> <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/> </svg> <strong>siml.earth</strong> </a> <div class="hidden md:block ml-6"> <div class="flex items-center space-x-4"> <div class="relative group"> <button class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"> Sites </button> <div class="hidden group-hover:block absolute z-50 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 before:content-[''] before:absolute before:top-[-10px] before:left-0 before:w-full before:h-[10px]"> <div class=py-1 > <div class="px-4 py-2 text-sm text-gray-700">Choose a Site</div> <a href="/jan/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Jan's Site</a> <a href="/ann/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Ann's Site</a> </div> </div> </div> <div class="border-l border-gray-700 h-6"></div> <span class="text-gray-300 font-bold">Jan's:</span> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Home</a> <a href="/jan/scratchpad/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Posts</a> <a href="/jan/wip/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Work in Progress</a> <a href="/jan/about/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">About</a> <a href="/jan/tags/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Tags</a> <a href="/jan/privacy_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Privacy Policy</a> <a href="/jan/cookie_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm">Cookie Policy</a> </div> </div> </div> <button type=button  class="md:hidden bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none" aria-controls=mobile-menu  aria-expanded=false > <span class=sr-only >Open main menu</span> <svg class="h-6 w-6" fill=none  viewBox="0 0 24 24" stroke=currentColor > <path stroke-linecap=round  stroke-linejoin=round  stroke-width=2  d="M4 6h16M4 12h16M4 18h16" /> </svg> </button> </div> </div> <div class="md:hidden hidden" id=mobile-menu > <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Jan's Site</a> <a href="/ann/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Ann's Site</a> <div class="border-t border-gray-700 my-2"></div> <span class="text-gray-300 font-bold px-3">Jan's:</span> <a href="/jan/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Home</a> <a href="/jan/scratchpad/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Posts</a> <a href="/jan/wip/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Work in Progress</a> <a href="/jan/about/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">About</a> <a href="/jan/tags/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Tags</a> <a href="/jan/privacy_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Privacy Policy</a> <a href="/jan/cookie_policy/" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base">Cookie Policy</a> </div> </div> </nav> </header> <div class="container px-3 mx-auto pt-20"> <div class="max-w-4xl mx-auto"> <h1 class="text-4xl font-bold mb-4 text-center">Running a 70 Billion-Parameter LLM on Your Laptop?</h1> <p class="text-gray-600 mb-8 text-center">11 January 2024</p> </div> <div class=franklin-content ><h1 id=tldr ><a href="#tldr" class=header-anchor >TL;DR</a></h1> <p>You can now run the 70 billion parameter Llama2 language model locally on an M1 Mac in Julia &#40;thanks to llama.cpp 2-bit quantization&#41;</p> <p><div class=franklin-toc ><ol><li><a href="#tldr">TL;DR</a><ol><li><a href="#running_a_70_billion-parameter_llm_on_your_laptop">Running a 70 Billion-Parameter LLM on Your Laptop?</a><li><a href="#llamajl_to_the_rescue">Llama.jl to the rescue&#33;</a><li><a href="#try_the_rocket_model">Try the Rocket model</a><li><a href="#conclusion">Conclusion</a></ol></ol></div> </p> <h2 id=running_a_70_billion-parameter_llm_on_your_laptop ><a href="#running_a_70_billion-parameter_llm_on_your_laptop" class=header-anchor >Running a 70 Billion-Parameter LLM on Your Laptop?</a></h2> <p>It&#39;s a fascinating time in the world of generative AI and large language models. I recently had an experience that seemed almost surreal just a year ago—I ran a 70 billion parameter language model, Llama2, locally on my Mac M1. To put that into perspective, if each parameter were an M&amp;M, we could fill more than 10 Olympic-sized swimming pools&#33;</p> <p>What made this possible is the recent release of Llama.cpp, supporting new 2-bit quantization. This practically compresses the model to use almost 16 times less memory compared to traditional Float32 parameters. It&#39;s an incredible leap in model efficiency and accessibility. It&#39;s not without &quot;price&quot;, but its performance is still impressive.</p> <h2 id=llamajl_to_the_rescue ><a href="#llamajl_to_the_rescue" class=header-anchor >Llama.jl to the rescue&#33;</a></h2> <p>For those eager to try this out, the Julia programming community has made it incredibly easy. Recently, I discovered a nifty package <a href="https://github.com/marcom/Llama.jl">Llama.jl</a>, which wraps the famous llama.cpp, but you don&#39;t have to compile anything&#33; Julia&#39;s Artifact ecosystem streamlines the process.</p> <p>Here’s how you can do it:</p> <pre><code class="julia hljs"><span class=hljs-comment ># Install the package first</span>
<span class=hljs-keyword >using</span> Pkg; Pkg.add(<span class=hljs-string >&quot;https://github.com/marcom/Llama.jl&quot;</span>)

<span class=hljs-keyword >using</span> Llama

<span class=hljs-comment ># Go make a cup of tea while you wait... this is a 20GB download!</span>
url = <span class=hljs-string >&quot;https://huggingface.co/ikawrakow/various-2bit-sota-gguf/resolve/main/llama-v2-70b-2.12bpw.gguf&quot;</span>
model = download_model(url) 

<span class=hljs-comment ># and now we can run the server:</span>
Llama.run_server(; model)
<span class=hljs-comment ># Note: If you get some memory or GPU problems, look at parameter `n_gpu_layers`, which dictates how many layers of your model should go onto your GPU vs CPU</span></code></pre> <p>To try it out either open http://127.0.0.1:10897 in your browser or use PromptingTools.jl like you would with any OpenAI-compatible server:</p> <p>Open a separate Julia session and run:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> PromptingTools
<span class=hljs-keyword >const</span> PT = PromptingTools

msg = aigenerate(PT.CustomOpenAISchema(), <span class=hljs-string >&quot;What is Julia lang good for?&quot;</span>; api_kwargs=(; url=<span class=hljs-string >&quot;http://127.0.0.1:10897/v1&quot;</span>))</code></pre> <p>It may take a few seconds...</p> <pre><code class="plaintext hljs">[ Info: Tokens: 97 in 19.2 seconds
AIMessage(&quot;Julia is a high-level, high performance dynamic programming language for numerical computing. It provides an ecosystem of open source tools built by the community.&quot;)</code></pre> <p>The above code snippet allows you to download and run a massive 70 billion-parameter model right on your machine with just ~20GB of memory requirement &#40;it&#39;s slightly more than that but not 200GB like the original model&#41;. </p> <h2 id=try_the_rocket_model ><a href="#try_the_rocket_model" class=header-anchor >Try the Rocket model</a></h2> <p>If a 20GB model seems overkill for your needs, try the <a href="https://huggingface.co/pansophic/rocket-3B">Rocket model</a>, which is less than 1GB in size but still boasts 3 billion parameters.</p> <pre><code class="julia hljs"><span class=hljs-comment ># Download the Rocket model and start your server</span>
url = <span class=hljs-string >&quot;https://huggingface.co/ikawrakow/various-2bit-sota-gguf/resolve/main/rocket-3b-2.76bpw.gguf&quot;</span>
model = download_model(url) <span class=hljs-comment ># 1GB download</span>
Llama.run_server(; model)</code></pre> <p>In a separate Julia session, call the model with PromptingTools.jl</p> <pre><code class="julia hljs"><span class=hljs-comment ># In a separate Julia session, call the model with PromptingTools.jl</span>
<span class=hljs-keyword >using</span> PromptingTools
<span class=hljs-keyword >const</span> PT = PromptingTools
<span class=hljs-comment ># PT.register_model!(; name=&quot;llama70b&quot;, schema=PT.CustomOpenAISchema())</span>

msg = aigenerate(PT.CustomOpenAISchema(), <span class=hljs-string >&quot;Say hi!&quot;</span>; api_kwargs=(; url=<span class=hljs-string >&quot;http://127.0.0.1:10897/v1&quot;</span>))
<span class=hljs-comment ># [ Info: Tokens: 75 in 5.9 seconds</span>
<span class=hljs-comment ># AIMessage(&quot;Hello there! I&#x27;m glad you reached out to me. I&#x27;ll do my best to be a helpful AI assistant, so if you have any questions or need assistance with anything, just let me know and I&#x27;d be happy to help. Hi there!&quot;)</span>

msg = aigenerate(PT.CustomOpenAISchema(), <span class=hljs-string >&quot;What is Julia lang good for?&quot;</span>; api_kwargs=(; url=<span class=hljs-string >&quot;http://127.0.0.1:10897/v1&quot;</span>, max_tokens=<span class=hljs-number >2000</span>))
<span class=hljs-comment ># [ Info: Tokens: 137 in 12.6 seconds</span>
<span class=hljs-comment ># AIMessage(&quot;Julia is a high-performance, open-source numerical computing language designed for scientific and engineering applications. It offers fast and efficient computation capabilities with features like multi-threading, automatic array memory optimization, and built-in support for popular libraries such as NumPy, Pandas, and Matplotlib. Julia has gained popularity among data scientists, engineers, and researchers due to its speed, scalability, and ease of use. It is particularly useful when you need to perform complex computations with large datasets or handle high-dimensional arrays efficiently.&quot;)</span></code></pre> <h2 id=conclusion ><a href="#conclusion" class=header-anchor >Conclusion</a></h2> <p>As you can see, the responses are impressive for a 1GB model&#33; It’s truly remarkable how the open-source scene is rapidly advancing, making powerful AI tools accessible to more and more people.</p> <p>This exploration into running large language models locally is just a glimpse into the potential of AI and how it&#39;s being democratized. It&#39;s a testament to the power of open-source software and the continuous innovation in the field of AI and data science. Stay tuned for more amazing developments&#33;</p> <p>PS: Yes, we do need a nicer integration between PromptingTools.jl and Llama.jl. I&#39;m already working on it. Stay tuned&#33;</p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Jan Siml. Last modified: December 09, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia asdasdas programming language</a>. </div> </div></div> <footer class="container mx-auto px-4 py-4 border-t"> <p class="text-right mb-3"> <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">Back to top</a> </p> <div class="flex flex-col items-center justify-center space-y-3"> <div class=footer-icons > <ul class="flex items-center space-x-4"> <li class="text-gray-700 font-medium">Follow: <li> <a href="https://github.com/svilupp" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors" rel="nofollow noopener noreferrer"> <svg xmlns="http://www.w3.org/2000/svg" width=20  height=20  fill=currentColor  class="bi bi-github" viewBox="0 0 16 16"> <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/> </svg> <span>GitHub</span> </a> </ul> </div> <p class="text-sm text-gray-600"> &copy; 2024 · <a href="#" class="hover:text-gray-900 transition-colors">Privacy</a> · <a href="#" class="hover:text-gray-900 transition-colors">Terms</a> </p> </div> </footer> <script src="/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script> // Mobile menu toggle const mobileMenuButton = document.querySelector('[aria-controls="mobile-menu"]'); const mobileMenu = document.getElementById('mobile-menu'); mobileMenuButton.addEventListener('click', () => { const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true'; mobileMenuButton.setAttribute('aria-expanded', !expanded); mobileMenu.classList.toggle('hidden'); }); </script>